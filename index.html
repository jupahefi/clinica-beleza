<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ClÃ­nica Beleza - Sistema de GestiÃ³n</title>
  
  <!-- Cache Control para desarrollo -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta name="description" content="Sistema integral de gestiÃ³n para clÃ­nica estÃ©tica. Maneja pacientes, ventas, pagos y sesiones de tratamientos de belleza.">
  <meta name="keywords" content="clÃ­nica estÃ©tica, gestiÃ³n, tratamientos, depilaciÃ³n, facial, corporal">
  <meta name="author" content="ClÃ­nica Beleza">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://clinica-beleza.equalitech.xyz/">
  <meta property="og:title" content="ClÃ­nica Beleza - Sistema de GestiÃ³n">
  <meta property="og:description" content="Sistema integral de gestiÃ³n para clÃ­nica estÃ©tica. Maneja pacientes, ventas, pagos y sesiones de tratamientos de belleza.">
  <meta property="og:image" content="https://clinica-beleza.equalitech.xyz/logo.png?v=2">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:type" content="image/png">
  <meta property="og:locale" content="es_ES">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://clinica-beleza.equalitech.xyz/">
  <meta property="twitter:title" content="ClÃ­nica Beleza - Sistema de GestiÃ³n">
  <meta property="twitter:description" content="Sistema integral de gestiÃ³n para clÃ­nica estÃ©tica. Maneja pacientes, ventas, pagos y sesiones de tratamientos de belleza.">
  <meta property="twitter:image" content="https://clinica-beleza.equalitech.xyz/logo.png?v=2">
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="apple-touch-icon" href="logo.png">
  
  <link rel="stylesheet" href="styles.css?v=3.1">
</head>
<body>
  <header class="header">
    <nav class="nav">
      <a href="#" class="logo" onclick="showView('ficha')">
        <img src="logo.png?v=3.1" alt="ClÃ­nica Beleza Logo">
        <span class="logo-text">ClÃ­nica Beleza</span>
      </a>
      <button class="nav-btn active" onclick="showView('ficha')">Fichas</button>
      <button class="nav-btn" onclick="showView('ventas')">Ventas</button>
      <button class="nav-btn" onclick="showView('pagos')">Pagos</button>
      <button class="nav-btn" onclick="showView('sesiones')">Sesiones</button>
      <button class="nav-btn" onclick="showView('boxes')">Boxes</button>
      <button class="nav-btn" onclick="showView('ofertas')">Ofertas</button>
      <button class="nav-btn" onclick="showView('historial')">Historial</button>
    </nav>
  </header>

  <div class="container">
    <!-- Vista de Fichas -->
    <div id="ficha" class="view active">
      <div class="card">
        <h1>GestiÃ³n de Fichas de Pacientes</h1>
        
        <div class="form-group">
          <label>Seleccionar Paciente Existente</label>
          <select id="pacienteSelect">
            <option value="">-- Crear nuevo paciente --</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Nombre Completo</label>
            <input type="text" id="nombrePaciente" placeholder="Ej: Ana MarÃ­a PÃ©rez">
          </div>
          <div class="form-group">
            <label>RUT <small>(se autocompleta al escribir 7 dÃ­gitos)</small></label>
            <input type="text" id="rutPaciente" placeholder="Ej: 18364827 (sin puntos ni guiÃ³n)" maxlength="13">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Edad</label>
            <input type="number" id="edadPaciente" min="0" max="120">
          </div>
          <div class="form-group">
            <label>TelÃ©fono <small>(se formatea automÃ¡ticamente)</small></label>
            <div class="phone-input-container">
              <select id="codigoPais" class="country-select">
                <option value="+56" data-flag="ğŸ‡¨ğŸ‡±">ğŸ‡¨ğŸ‡± +56</option>
                <option value="+54" data-flag="ğŸ‡¦ğŸ‡·">ğŸ‡¦ğŸ‡· +54</option>
                <option value="+55" data-flag="ğŸ‡§ğŸ‡·">ğŸ‡§ğŸ‡· +55</option>
                <option value="+57" data-flag="ğŸ‡¨ğŸ‡´">ğŸ‡¨ğŸ‡´ +57</option>
                <option value="+51" data-flag="ğŸ‡µğŸ‡ª">ğŸ‡µğŸ‡ª +51</option>
                <option value="+1" data-flag="ğŸ‡ºğŸ‡¸">ğŸ‡ºğŸ‡¸ +1</option>
                <option value="+34" data-flag="ğŸ‡ªğŸ‡¸">ğŸ‡ªğŸ‡¸ +34</option>
              </select>
              <input type="tel" id="telefonoPaciente" placeholder="Ej: 9 2847 8472" maxlength="15">
            </div>
          </div>
        </div>

        <div class="form-group">
          <label>Email <small>(detecta errores comunes)</small></label>
          <input type="email" id="emailPaciente" placeholder="Ej: nombre@gmail.com" maxlength="254">
        </div>

        <div class="form-group">
          <label>Observaciones Generales</label>
          <textarea id="observacionesPaciente" rows="3" placeholder="Alergias, condiciones mÃ©dicas, etc."></textarea>
        </div>

        <div class="form-group">
          <label>Fichas EspecÃ­ficas (puedes seleccionar mÃºltiples)</label>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="fichaDepilacion" value="depilacion">
              <label for="fichaDepilacion">DepilaciÃ³n</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="fichaCorporal" value="corporal">
              <label for="fichaCorporal">Corporal/Facial</label>
            </div>
          </div>
        </div>

        <button class="btn" onclick="guardarPaciente()">Guardar Ficha</button>
      </div>

      <!-- Ficha EspecÃ­fica de DepilaciÃ³n -->
      <div class="card hidden" id="fichaDepilacionCard">
        <h3>Ficha EspecÃ­fica - DepilaciÃ³n</h3>
        <div class="form-group">
          <label>Zonas a Tratar</label>
          <textarea id="zonasDepilacion" rows="3" placeholder="Ej: Piernas completas, axilas, bikini"></textarea>
        </div>
        <div class="form-group">
          <label>Tipo de Piel</label>
          <select id="tipoPiel">
            <option value="">Seleccionar tipo de piel</option>
          </select>
        </div>
        <div class="form-group">
          <label>Medicamentos/Fotosensibilizantes</label>
          <textarea id="medicamentos" rows="2" placeholder="Medicamentos que puedan afectar el tratamiento"></textarea>
        </div>
        <div class="form-group">
          <label>Observaciones MÃ©dicas</label>
          <textarea id="observacionesMedicas" rows="3" placeholder="Contraindicaciones, cuidados especiales"></textarea>
        </div>
      </div>

      <!-- Ficha EspecÃ­fica Corporal/Facial -->
      <div class="card hidden" id="fichaCorporalCard">
        <h3>Ficha EspecÃ­fica - Corporal/Facial</h3>
        <div class="form-group">
          <label>Tratamientos EstÃ©ticos Previos</label>
          <textarea id="tratamientosPrevios" rows="3" placeholder="Describe tratamientos anteriores"></textarea>
        </div>
        <div class="form-group">
          <label>Objetivo EstÃ©tico Principal</label>
          <textarea id="objetivoEstetico" rows="2" placeholder="Reducir celulitis, reafirmar piel, etc."></textarea>
        </div>
        <div class="form-group">
          <label>Zona de Tratamiento</label>
          <select id="zonaTratamiento">
            <option value="">Seleccionar zona</option>
          </select>
        </div>
        <div class="form-group">
          <label>Expectativas del Paciente</label>
          <textarea id="expectativas" rows="2" placeholder="QuÃ© espera lograr con el tratamiento"></textarea>
        </div>
      </div>
    </div>

    <!-- Vista de Ventas -->
    <div id="venta" class="view">
      <div class="card">
        <h1>Sistema de Ventas</h1>
        
        <div class="form-group">
          <label>Seleccionar Paciente</label>
          <select id="clienteVenta">
            <option value="">-- Seleccionar paciente --</option>
          </select>
        </div>

        <div class="form-group">
          <label>Tratamiento</label>
          <select id="tratamientoVenta">
            <option value="">-- Seleccionar tratamiento --</option>
          </select>
        </div>

        <div class="form-group hidden" id="packsDiv">
          <label>Pack Disponible</label>
          <select id="packVenta">
            <option value="">-- Modalidad por sesiones --</option>
          </select>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Cantidad de Sesiones</label>
            <input type="number" id="sesionesVenta" min="1" value="1">
          </div>
          <div class="form-group">
            <label>Oferta Adicional (%)</label>
            <input type="number" id="ofertaVenta" min="0" max="100" value="0">
          </div>
        </div>

        <div class="form-group">
          <label>Observaciones de la Venta</label>
          <textarea id="observacionesVenta" rows="2" placeholder="Notas especiales sobre esta venta"></textarea>
        </div>

        <div class="result-box hidden" id="resultadoVenta">
          <div class="result-price" id="precioFinal">$0</div>
          <div id="detalleVenta">Selecciona un tratamiento</div>
        </div>

        <button class="btn" onclick="confirmarVenta()">Confirmar Venta</button>
      </div>

      <div class="card" id="historialClienteCard">
        <h3>Historial del Cliente</h3>
        <div id="historialCliente">Selecciona un cliente para ver su historial</div>
      </div>
    </div>

    <!-- Vista de Pagos -->
    <div id="pagos" class="view">
      <div class="card">
        <h1>GestiÃ³n de Pagos</h1>
        
        <div class="form-group">
          <label>Seleccionar Venta Pendiente</label>
          <select id="ventaPago">
            <option value="">-- Seleccionar venta --</option>
          </select>
        </div>

        <div class="card hidden" id="detallePagoCard">
          <h3>Detalle de la Venta</h3>
          <div id="detalleVentaPago"></div>
          
          <div class="form-row mt-2">
            <div class="form-group">
              <label>Monto a Pagar</label>
              <input type="number" id="montoPago" min="0">
            </div>
            <div class="form-group">
              <label>MÃ©todo de Pago</label>
              <select id="metodoPago">
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Fecha de Pago</label>
            <input type="date" id="fechaPago">
          </div>

          <div class="form-group">
            <label>Observaciones del Pago</label>
            <textarea id="observacionesPago" rows="2" placeholder="Notas sobre este pago"></textarea>
          </div>

          <button class="btn" onclick="registrarPago()">Registrar Pago</button>
        </div>
      </div>

      <div class="card">
        <h3>Historial de Pagos</h3>
        <div class="item-list" id="listaPagos">
          No hay pagos registrados
        </div>
      </div>
    </div>

    <!-- Vista de Sesiones -->
    <div id="sesiones" class="view">
      <!-- Calendario del DÃ­a -->
      <div class="card">
        <h1>ğŸ“… GestiÃ³n de Sesiones</h1>
        
        <div class="form-row">
          <div class="form-group">
            <label>ğŸ“… Fecha del Calendario</label>
            <input type="date" id="fechaSelector">
          </div>
          <div class="form-group">
            <button class="btn btn-secondary" onclick="cargarSesionesHoy()">Hoy</button>
          </div>
        </div>

        <div id="sesionesHoy">
          <!-- Se cargan automÃ¡ticamente las sesiones del dÃ­a -->
        </div>
      </div>

      <!-- SesiÃ³n Activa -->
      <div class="card hidden" id="sesionActualCard">
        <h3>â±ï¸ SesiÃ³n en Curso</h3>
        <div id="detallesSesionActual"></div>
        <div class="form-group mt-2">
          <label>ğŸ“ Observaciones de la SesiÃ³n</label>
          <textarea id="observacionesSesion" rows="3" placeholder="Notas sobre cÃ³mo transcurriÃ³ la sesiÃ³n"></textarea>
        </div>
        <button class="btn btn-danger" onclick="terminarSesion()">âœ… Terminar SesiÃ³n</button>
      </div>

      <!-- Nuevo Agendamiento -->
      <div class="card">
        <h3>ğŸ“‹ Agendar Nueva SesiÃ³n</h3>
        
        <div class="form-group buscador-container">
          <label>ğŸ” Buscar Cliente</label>
          <input type="text" id="buscadorCliente" placeholder="Escribe nombre o RUT del cliente">
          <div id="resultadosBusqueda" class="resultado-busqueda hidden"></div>
        </div>

        <div id="ventasDisponibles" class="hidden">
          <!-- Se cargan las ventas con sesiones disponibles -->
        </div>

        <div id="accionesSesion" class="hidden">
          <div class="form-row">
            <div class="form-group">
              <label>ğŸ“… Fecha y Hora</label>
              <input type="datetime-local" id="fechaAgendaUnica">
            </div>
            <div class="form-group">
              <label>ğŸ¢ Box/Sala</label>
              <select id="boxSeleccionado">
                <option value="1">Box 1</option>
                <option value="2">Box 2</option>
                <option value="3">Box 3</option>
              </select>
            </div>
          </div>
          
          <div class="form-actions">
            <button class="btn" onclick="agendarSesionUnica()">ğŸ“… Agendar Una SesiÃ³n</button>
            <button class="btn btn-primary" onclick="generarPlanSesiones()" id="btnPlanSesiones">ğŸ—“ï¸ Generar Plan Completo</button>
          </div>
        </div>
      </div>

      <!-- Plan de Sesiones -->
      <div class="card hidden" id="planSesiones">
        <!-- Se genera dinÃ¡micamente -->
      </div>



      <!-- Sesiones Agendadas (Vista ClÃ¡sica) -->
      <div class="card">
        <h3>ğŸ“‹ Agenda General</h3>
        <div class="item-list" id="sesionesAgendadas">
          No hay sesiones agendadas
        </div>
      </div>
    </div>

    <!-- Modales para Sesiones -->
    <div id="modalConfirmacionSesion" class="modal hidden">
      <div class="modal-content">
        <div id="detallesSesionConfirmar">
          <!-- Contenido dinÃ¡mico -->
        </div>
        <div class="form-actions">
          <button class="btn btn-primary" id="btnConfirmarSesion">âœ… Confirmar e Iniciar</button>
          <button class="btn btn-secondary" id="btnCancelarConfirmacion">âŒ Cancelar</button>
        </div>
      </div>
    </div>

    <div id="modalEditarSesion" class="modal hidden">
      <div class="modal-content">
        <div id="formularioEditarSesion">
          <!-- Contenido dinÃ¡mico -->
        </div>
      </div>
    </div>

    <!-- Vista de Boxes -->
    <div id="boxes" class="view">
      <div class="card">
        <h1>ğŸ¢ GestiÃ³n de Boxes/Salas</h1>
        <p>Administra las salas y boxes disponibles para los tratamientos.</p>
        
        <div class="form-actions mb-2">
          <button class="btn btn-primary" onclick="aÃ±adirBox()">â• AÃ±adir Nuevo Box</button>
        </div>
        
        <div id="boxesDisponibles">
          <!-- Se cargan automÃ¡ticamente -->
        </div>
      </div>

      <div class="card">
        <h3>ğŸ“Š Estado de Boxes</h3>
        <div id="estadoBoxes">
          <!-- EstadÃ­sticas de uso -->
        </div>
      </div>

      <div class="card">
        <h3>âš™ï¸ ConfiguraciÃ³n de Boxes</h3>
        <div class="form-row">
          <div class="form-group">
            <label>Capacidad Total de Boxes</label>
            <input type="number" id="capacidadTotal" min="1" max="20" value="3" readonly>
          </div>
          <div class="form-group">
            <label>Boxes Activos</label>
            <input type="number" id="boxesActivos" readonly>
          </div>
        </div>
        
        <div class="form-group">
          <label>Horario de AtenciÃ³n</label>
          <div class="form-row">
            <input type="time" id="horarioInicio" value="09:00">
            <span>hasta</span>
            <input type="time" id="horarioFin" value="18:00">
          </div>
        </div>
        
        <button class="btn btn-secondary" onclick="guardarConfiguracionBoxes()">ğŸ’¾ Guardar ConfiguraciÃ³n</button>
      </div>
    </div>

    <!-- Vista de Ofertas -->
    <div id="ofertas" class="view">
      <div class="card">
        <h1>GestiÃ³n de Ofertas</h1>
        
        <div id="listaTratamientosOfertas">
          <!-- Se carga dinÃ¡micamente -->
        </div>

        <div class="card hidden" id="crearOfertaCard">
          <h3>Crear Oferta</h3>
          <div class="form-group">
            <label>Tratamiento Seleccionado</label>
            <input type="text" id="tratamientoOferta" readonly>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Descuento (%)</label>
              <input type="number" id="descuentoOferta" min="0" max="100">
            </div>
            <div class="form-group">
              <label>Precio Fijo (opcional)</label>
              <input type="number" id="precioFijoOferta" min="0">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Fecha Inicio</label>
              <input type="date" id="fechaInicioOferta">
            </div>
            <div class="form-group">
              <label>Fecha Fin</label>
              <input type="date" id="fechaFinOferta">
            </div>
          </div>

          <div class="form-group">
            <label>DescripciÃ³n de la Oferta</label>
            <textarea id="descripcionOferta" rows="2" placeholder="Describe los tÃ©rminos de la oferta"></textarea>
          </div>

          <button class="btn" onclick="guardarOferta()">Guardar Oferta</button>
          <button class="btn btn-secondary" onclick="cancelarOferta()">Cancelar</button>
        </div>
      </div>

      <div class="card">
        <h3>Ofertas Activas</h3>
        <div class="item-list" id="ofertasActivas">
          No hay ofertas activas
        </div>
      </div>
    </div>

    <!-- Vista de Historial -->
    <div id="historial" class="view">
      <div class="card">
        <h1>Historial General de Compras</h1>
        
        <div class="form-group">
          <label>Filtrar por Cliente</label>
          <select id="filtroCliente">
            <option value="">-- Todos los clientes --</option>
          </select>
        </div>

        <div class="item-list" id="historialCompleto">
          No hay ventas registradas
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="js/main.js?v=3.1"></script>
  
  <!-- Herramientas de desarrollo (solo en desarrollo) -->
  <script>
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.search.includes('dev=1')) {
      const script = document.createElement('script');
      script.src = 'dev-tools.js';
      document.head.appendChild(script);
    }
  </script>
  
  <!-- Service Worker para gestiÃ³n de cache -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registrado: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registro fallÃ³: ', registrationError);
          });
      });
    }
  </script>
</body>
</html>
